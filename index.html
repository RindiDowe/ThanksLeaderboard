<script>
  // 1) ðŸ”§ Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCdgAgCChuiHXKx3N9Re1z5bGYoVz_iZAE",
    authDomain: "cestypingchallenge.firebaseapp.com",
    projectId: "cestypingchallenge",
    storageBucket: "cestypingchallenge.firebasestorage.app",
    messagingSenderId: "1085002897356",
    appId: "1:1085002897356:web:318e8e0162224a96f4af69",
    measurementId: "G-40647JYDD0"
    // NOTE: In Firebase console â†’ Realtime Database, grab your database URL
    // and add: databaseURL: "https://YOUR_DB_URL_HERE"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  // Use a path thatâ€™s specific to this game/year
  const scoresRef = db.ref("thanksgivingTypingScores2025");

  // DOM elements
  const playerNameInput = document.getElementById("playerName");
  const lockNameBtn = document.getElementById("lockNameBtn");
  const playerStatus = document.getElementById("playerStatus");

  const targetTextEl = document.getElementById("targetText");
  const typingInput = document.getElementById("typingInput");
  const startRoundBtn = document.getElementById("startRoundBtn");
  const submitBtn = document.getElementById("submitBtn");

  const timerDisplay = document.getElementById("timerDisplay");
  const wpmStat = document.getElementById("wpmStat");
  const accuracyStat = document.getElementById("accuracyStat");
  const resultMessage = document.getElementById("resultMessage");
  const leaderboardList = document.getElementById("leaderboardList");

  let currentPlayerName = "";
  let currentSentence = "";
  let roundActive = false;
  let startTime = null;
  let timerInterval = null;

  // Thanksgiving paragraphs (each round = about 3 sentences)
  const sentences = [
    "On Thanksgiving morning, our house smells like turkey and spices. The kitchen counters are covered with pie crusts, cranberries, and fresh rolls. Everyone helps a little, even if it just means taste-testing the food.",
    "We set the table with our nicest plates and colorful napkins. A big bowl of mashed potatoes sits next to the gravy boat. In the center, a small pumpkin holds a candle that flickers softly.",
    "Before we eat, each person shares something they are thankful for this year. Some people talk about family and friends, and others mention school and teachers. By the end, the room feels warm with gratitude.",
    "After dinner, our family likes to go for a walk in the chilly autumn air. The leaves crunch under our shoes, and our breath makes tiny white clouds. We talk, laugh, and point out the brightest stars in the sky.",
    "My favorite part of Thanksgiving is dessert time. There are slices of pumpkin pie, apple pie, and sometimes even chocolate cake. We add whipped cream on top and pretend we are food judges on a cooking show.",
    "Our cousins drive for hours just to spend Thanksgiving with us. When they arrive, everyone shouts and runs to the door. The house suddenly feels louder, sillier, and much more fun.",
    "After we eat, some people watch football while others play board games. The living room fills with cheers, groans, and bursts of laughter. Even the dog curls up nearby, hoping for dropped snacks.",
    "On the day after Thanksgiving, we like to make turkey sandwiches with the leftovers. We stack turkey, lettuce, and cranberry sauce on fresh bread. Somehow, the leftovers taste just as good as the feast."
  ];

  function pickRandomSentence() {
    const idx = Math.floor(Math.random() * sentences.length);
    return sentences[idx];
  }

  function resetTimer() {
    clearInterval(timerInterval);
    timerInterval = null;
    timerDisplay.textContent = "0.0 s";
  }

  function startTimer() {
    startTime = performance.now();
    resetTimer();
    timerInterval = setInterval(() => {
      if (!startTime) return;
      const elapsedMs = performance.now() - startTime;
      const seconds = elapsedMs / 1000;
      timerDisplay.textContent = seconds.toFixed(1) + " s";
    }, 100);
  }

  function stopTimer() {
    if (!startTime) return 0;
    const elapsedMs = performance.now() - startTime;
    startTime = null;
    clearInterval(timerInterval);
    timerInterval = null;
    return elapsedMs;
  }

  function celebrate() {
    // Simple confetti burst
    const pieces = 40;
    for (let i = 0; i < pieces; i++) {
      const div = document.createElement("div");
      div.className = "confetti-piece";
      div.style.left = Math.random() * 100 + "vw";
      div.style.backgroundColor = ["#f97316", "#facc15", "#22c55e", "#ec4899"][Math.floor(Math.random() * 4)];
      div.style.animationDelay = (Math.random() * 0.3) + "s";
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 1600);
    }

    // Little text cheer
    resultMessage.classList.remove("bad");
    resultMessage.classList.add("good");
    resultMessage.textContent = "Gobble gobble! Great round!";
  }

  function saveScore(name, wpm, accuracy) {
    const createdAt = Date.now();
    scoresRef.push({
      name,
      wpm,
      accuracy,
      createdAt
    });
  }

  function renderLeaderboard(snapshot) {
    const data = snapshot.val() || {};
    const rows = Object.values(data);

    // Sort: highest WPM, then highest accuracy, then newest
    rows.sort((a, b) => {
      if (b.wpm !== a.wpm) return b.wpm - a.wpm;
      if (b.accuracy !== a.accuracy) return b.accuracy - a.accuracy;
      return b.createdAt - a.createdAt;
    });

    const topTen = rows.slice(0, 10);

    leaderboardList.innerHTML = "";
    topTen.forEach((row, index) => {
      const li = document.createElement("li");
      const place = document.createElement("span");
      place.className = "place";
      place.textContent = (index + 1) + ".";

      const name = document.createElement("span");
      name.className = "name";
      name.textContent = row.name || "Unknown";

      const score = document.createElement("span");
      score.className = "score";
      score.textContent = `${row.wpm} WPM â€¢ ${row.accuracy.toFixed(0)}%`;

      li.appendChild(place);
      li.appendChild(name);
      li.appendChild(score);
      leaderboardList.appendChild(li);
    });

    if (topTen.length === 0) {
      const li = document.createElement("li");
      li.innerHTML = `<span class="place">â€“</span><span class="name">No scores yet</span><span class="score">Be the first turkey!</span>`;
      leaderboardList.appendChild(li);
    }
  }

  // Listen for leaderboard changes
  scoresRef.on("value", renderLeaderboard);

  // Lock player name
  lockNameBtn.addEventListener("click", () => {
    const name = playerNameInput.value.trim();
    if (!name) {
      playerStatus.textContent = "Please enter a name before locking in.";
      retu
